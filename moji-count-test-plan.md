# もじカウントアプリケーション - 包括的テストプラン

## アプリケーション概要

もじカウントは、テキストの文字数を正確にカウントするWebアプリケーションです。以下の機能を提供します：

- **文字数カウント機能**: テキストエリアに入力されたテキストの文字数をリアルタイムで計測
- **高度な文字認識**: ひらがな、カタカナ、漢字、アルファベット、記号、絵文字など、あらゆる文字種に対応
- **書記素単位のカウント**: Intl.Segmenter APIを使用して書記素（grapheme）単位で正確にカウント
- **フォールバック機能**: Intl.Segmenter未対応ブラウザではユニコードのコードポイント単位でカウント
- **レスポンシブデザイン**: デスクトップ・モバイル双方に対応

## アクセス情報

- **ホームページ**: `http://localhost:3000`
- **アプリケーションURL**: `http://localhost:3000/moji-count`
- **ナビゲーション経路**: ホームページ → 「Assist」セクション → 「もじカウント」カード

## テストシナリオ

### 1. ナビゲーションとページ読み込み

**Seed:** `core/seed.spec.ts`

#### 1.1 ホームページからもじカウントへの遷移
**手順:**
1. ブラウザで`http://localhost:3000`にアクセス
2. ページが完全に読み込まれるまで待機
3. 「Assist」セクションまでスクロール
4. 「もじカウント」カード（📏アイコン付き）をクリック

**期待される結果:**
- `http://localhost:3000/moji-count`にリダイレクトされる
- ページタイトルが「もじカウント」と表示される
- テキストエリアとカウンター表示が正常に表示される

#### 1.2 直接URLアクセス
**手順:**
1. ブラウザで`http://localhost:3000/moji-count`に直接アクセス

**期待される結果:**
- ページが正常に読み込まれる
- 「もじカウント」の見出しが表示される
- テキストエリアに「ここに文字列を入力してください」というプレースホルダーが表示される
- 初期文字数が「0」と表示される

#### 1.3 メタデータの確認
**手順:**
1. `http://localhost:3000/moji-count`にアクセス
2. ページのメタデータを確認

**期待される結果:**
- ページタイトル: 「もじカウント」
- メタディスクリプション: 「テキストの文字数を数えます。ひらがな・カタカナ・漢字・アルファベット・記号・絵文字など、文字の種類を問わず数えられます。」
- Open Graph/Twitter Cardメタタグが適切に設定されている

---

### 2. 基本的な文字入力とカウント

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 2.1 英数字の入力
**手順:**
1. テキストエリアに「Hello World」と入力

**期待される結果:**
- リアルタイムで文字数が更新される
- 「文字数：」の後に「11」と表示される（スペース含む）

#### 2.2 ひらがなの入力
**手順:**
1. テキストエリアをクリア
2. 「こんにちは」と入力

**期待される結果:**
- 「文字数：」の後に「5」と表示される

#### 2.3 カタカナの入力
**手順:**
1. テキストエリアをクリア
2. 「コンニチハ」と入力

**期待される結果:**
- 「文字数：」の後に「5」と表示される

#### 2.4 漢字の入力
**手順:**
1. テキストエリアをクリア
2. 「今日は良い天気」と入力

**期待される結果:**
- 「文字数：」の後に「7」と表示される

#### 2.5 混合文字列の入力
**手順:**
1. テキストエリアをクリア
2. 「Hello世界123あいう」と入力

**期待される結果:**
- 「文字数：」の後に「14」と表示される

#### 2.6 改行を含む文字列
**手順:**
1. テキストエリアをクリア
2. 以下のテキストを入力:
```
こんにちは
世界
```

**期待される結果:**
- 改行文字も1文字としてカウントされる
- 「文字数：」の後に「7」と表示される（こんにちは5文字 + 改行1文字 + 世界2文字 - 最後の改行）

---

### 3. 特殊文字と絵文字のカウント

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 3.1 基本的な絵文字
**手順:**
1. テキストエリアに「😀😃😄」と入力

**期待される結果:**
- 「文字数：」の後に「3」と表示される（各絵文字を1文字としてカウント）

#### 3.2 結合文字を含む絵文字
**手順:**
1. テキストエリアをクリア
2. 「👨‍👩‍👧‍👦」（家族の絵文字、結合文字）を入力

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「1」と表示される（書記素単位）
- 未対応ブラウザでは複数文字としてカウントされる可能性がある

#### 3.3 肌色修飾子付き絵文字
**手順:**
1. テキストエリアをクリア
2. 「👋🏻👋🏼👋🏽」（手を振る絵文字、異なる肌色）を入力

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「3」と表示される
- 各修飾子付き絵文字が1文字としてカウントされる

#### 3.4 記号と特殊文字
**手順:**
1. テキストエリアをクリア
2. 「!@#$%^&*()」と入力

**期待される結果:**
- 「文字数：」の後に「10」と表示される

#### 3.5 全角記号
**手順:**
1. テキストエリアをクリア
2. 「！＠＃＄％」と入力

**期待される結果:**
- 「文字数：」の後に「5」と表示される

#### 3.6 絵文字とテキストの混合
**手順:**
1. テキストエリアをクリア
2. 「こんにちは😀世界🌍」と入力

**期待される結果:**
- 「文字数：」の後に「8」と表示される（ひらがな5 + 絵文字1 + 漢字2 + 絵文字1）

---

### 4. エッジケースとバリデーション

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 4.1 空文字列
**手順:**
1. テキストエリアが空の状態を確認

**期待される結果:**
- 「文字数：」の後に「0」と表示される
- エラーメッセージは表示されない

#### 4.2 スペースのみの入力
**手順:**
1. テキストエリアに半角スペースを5つ入力

**期待される結果:**
- 「文字数：」の後に「5」と表示される

#### 4.3 全角スペースの入力
**手順:**
1. テキストエリアをクリア
2. 全角スペースを5つ入力

**期待される結果:**
- 「文字数：」の後に「5」と表示される

#### 4.4 タブ文字の入力
**手順:**
1. テキストエリアをクリア
2. テキストエリア内でタブキーを押す（可能な場合）

**期待される結果:**
- タブ文字が入力された場合、1文字としてカウントされる
- ブラウザの動作によってはフォーカス移動する場合もある

#### 4.5 非常に長いテキスト（パフォーマンステスト）
**手順:**
1. テキストエリアをクリア
2. 1000文字以上の長文を入力（例: 「あ」を1000回繰り返す）

**期待される結果:**
- カウントが正確に行われる
- 「文字数：」の後に「1000」と表示される
- UIがフリーズしない
- レスポンスタイムが許容範囲内（数秒以内）

#### 4.6 特殊なユニコード文字
**手順:**
1. テキストエリアをクリア
2. 「𠮷野家」（「吉」の異体字を含む）を入力

**期待される結果:**
- 「文字数：」の後に「3」と表示される
- サロゲートペア文字が正しく1文字としてカウントされる

#### 4.7 ゼロ幅文字
**手順:**
1. テキストエリアをクリア
2. 「test​test」（間にゼロ幅スペースを含む）を入力

**期待される結果:**
- ゼロ幅文字もカウントに含まれる
- 「文字数：」の後に「9」と表示される

---

### 5. インタラクションとUI動作

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 5.1 リアルタイム更新の確認
**手順:**
1. テキストエリアに1文字ずつ「あいうえお」と入力
2. 各文字入力後のカウント表示を確認

**期待される結果:**
- 「あ」入力後: 「1」
- 「あい」入力後: 「2」
- 「あいう」入力後: 「3」
- 「あいうえ」入力後: 「4」
- 「あいうえお」入力後: 「5」
- 各入力に対してスムーズに更新される

#### 5.2 テキストの削除
**手順:**
1. テキストエリアに「こんにちは」と入力
2. Backspaceキーで1文字ずつ削除

**期待される結果:**
- 削除ごとにカウントが減少する
- 最終的に「0」になる

#### 5.3 テキストの全選択と置換
**手順:**
1. テキストエリアに「Hello」と入力
2. Ctrl+A（Mac: Cmd+A）で全選択
3. 「World」と入力

**期待される結果:**
- 「Hello」が「World」に置き換わる
- 「文字数：」の後に「5」と表示される

#### 5.4 コピー&ペースト
**手順:**
1. 別の場所から「テストテキスト」をコピー
2. テキストエリアに貼り付け

**期待される結果:**
- テキストが正常に貼り付けられる
- 「文字数：」の後に「7」と表示される
- カウントがすぐに更新される

#### 5.5 フォーカス状態の確認
**手順:**
1. テキストエリアをクリック
2. フォーカスインジケーターを確認

**期待される結果:**
- テキストエリアにフォーカスが当たる
- フォーカスリングまたは視覚的なフィードバックが表示される
- キーボード入力が可能

#### 5.6 プレースホルダーの表示
**手順:**
1. テキストエリアが空の状態を確認

**期待される結果:**
- 「ここに文字列を入力してください」というプレースホルダーが表示される
- プレースホルダーは薄いグレーで表示される
- テキスト入力開始でプレースホルダーが消える

---

### 6. アクセシビリティ

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 6.1 ラベルとARIA属性
**手順:**
1. ブラウザの開発者ツールでテキストエリアの属性を確認

**期待される結果:**
- テキストエリアに適切なラベル「カウントしたい文字列」が関連付けられている
- `aria-required="true"`属性が設定されている
- アクセシビリティツリーで正しく認識される

#### 6.2 キーボード操作
**手順:**
1. ページ読み込み後、Tabキーでナビゲート
2. テキストエリアにフォーカスが移動することを確認
3. テキストを入力
4. Shift+Tabで前の要素に戻る

**期待される結果:**
- キーボードのみで操作可能
- フォーカスの順序が論理的
- フォーカスインジケーターが常に表示される

#### 6.3 スクリーンリーダー対応
**手順:**
1. スクリーンリーダーを有効化（VoiceOver、NVDA等）
2. ページをナビゲート
3. テキストエリアにフォーカス

**期待される結果:**
- ラベル「カウントしたい文字列」が読み上げられる
- 必須フィールドであることがアナウンスされる
- 文字数カウンターが適切に読み上げられる

#### 6.4 コントラスト比
**手順:**
1. ブラウザの開発者ツールでテキストと背景のコントラストを測定

**期待される結果:**
- テキストと背景のコントラスト比がWCAG AA基準（4.5:1以上）を満たす
- プレースホルダーテキストも十分なコントラストがある

---

### 7. レスポンシブデザイン

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 7.1 デスクトップ表示（1920x1080）
**手順:**
1. ブラウザウィンドウを1920x1080にリサイズ
2. ページのレイアウトを確認

**期待される結果:**
- テキストエリアが適切なサイズで表示される
- すべての要素が読みやすい
- レイアウトが崩れない

#### 7.2 タブレット表示（768x1024）
**手順:**
1. ブラウザウィンドウを768x1024にリサイズ
2. ページのレイアウトを確認

**期待される結果:**
- レイアウトがタブレットサイズに適応
- テキストエリアが使いやすいサイズを維持
- カウンター表示が見やすい位置にある

#### 7.3 モバイル表示（375x667）
**手順:**
1. ブラウザウィンドウを375x667にリサイズ
2. ページのレイアウトを確認

**期待される結果:**
- モバイルレイアウトに切り替わる
- テキストエリアがモバイル画面に最適化される
- タップ可能な領域が十分な大きさ（最低44x44px）
- ズームなしで読める

#### 7.4 極小画面（320x568）
**手順:**
1. ブラウザウィンドウを320x568にリサイズ
2. ページのレイアウトを確認

**期待される結果:**
- レイアウトが崩れない
- すべてのコンテンツにアクセス可能
- 横スクロールが発生しない

---

### 8. パフォーマンスとメモリ

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 8.1 初期ロード時間
**手順:**
1. ブラウザのパフォーマンスツールを開く
2. ページをリロード
3. ロード時間を測定

**期待される結果:**
- Time to Interactive (TTI) が3秒以内
- First Contentful Paint (FCP) が1.5秒以内
- Largest Contentful Paint (LCP) が2.5秒以内

#### 8.2 連続入力時のパフォーマンス
**手順:**
1. テキストエリアに素早く連続で文字を入力
2. UIの応答性を観察

**期待される結果:**
- 入力遅延がない
- カウント表示が遅延なく更新される
- CPUスパイクが発生しない

#### 8.3 大量データ入力後のメモリ使用量
**手順:**
1. 10,000文字のテキストを入力
2. ブラウザのメモリ使用量を確認
3. テキストをクリア
4. 再度メモリ使用量を確認

**期待される結果:**
- メモリリークが発生しない
- テキストクリア後、メモリが解放される
- メモリ使用量が妥当な範囲内

---

### 9. ブラウザ互換性

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 9.1 Chrome（最新版）
**手順:**
1. Google Chromeでアプリケーションを開く
2. すべての基本機能をテスト

**期待される結果:**
- すべての機能が正常に動作
- Intl.Segmenter APIを使用した書記素単位のカウント
- ページ下部に「※書記素単位に分解して文字数を計測しています」と表示

#### 9.2 Firefox（最新版）
**手順:**
1. Mozilla Firefoxでアプリケーションを開く
2. すべての基本機能をテスト

**期待される結果:**
- すべての機能が正常に動作
- Intl.Segmenter APIのサポート状況に応じたカウント方法
- 適切なメッセージが表示される

#### 9.3 Safari（最新版）
**手順:**
1. Safariでアプリケーションを開く
2. すべての基本機能をテスト

**期待される結果:**
- すべての機能が正常に動作
- Intl.Segmenter APIのサポート状況に応じたカウント方法
- 適切なメッセージが表示される

#### 9.4 Edge（最新版）
**手順:**
1. Microsoft Edgeでアプリケーションを開く
2. すべての基本機能をテスト

**期待される結果:**
- すべての機能が正常に動作
- Chromeと同様の動作

#### 9.5 モバイルブラウザ（iOS Safari）
**手順:**
1. iOS SafariまたはiOSシミュレーターでアプリケーションを開く
2. タッチ操作でテキストを入力
3. カウント機能をテスト

**期待される結果:**
- タッチ操作が正常に動作
- ソフトウェアキーボードが適切に表示される
- カウント機能が正常に動作

#### 9.6 モバイルブラウザ（Android Chrome）
**手順:**
1. Android ChromeまたはAndroidエミュレーターでアプリケーションを開く
2. タッチ操作でテキストを入力
3. カウント機能をテスト

**期待される結果:**
- タッチ操作が正常に動作
- ソフトウェアキーボードが適切に表示される
- カウント機能が正常に動作

---

### 10. カウントロジックの詳細検証

**Seed:** `core/seed.spec.ts`（`http://localhost:3000/moji-count`にナビゲート）

#### 10.1 結合文字シーケンス
**手順:**
1. テキストエリアに「がぎぐげご」（濁点結合）を入力
2. カウントを確認

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「5」と表示
- 各文字が正しく1文字としてカウントされる

#### 10.2 異体字セレクタ
**手順:**
1. テキストエリアに「葛󠄀飾」（異体字セレクタ付き）を入力
2. カウントを確認

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「2」と表示
- 異体字セレクタが適切に処理される

#### 10.3 国旗絵文字
**手順:**
1. テキストエリアに「🇯🇵🇺🇸🇬🇧」（日本、米国、英国の国旗）を入力
2. カウントを確認

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「3」と表示
- 各国旗絵文字（地域インジケーター記号のペア）が1文字としてカウント

#### 10.4 ZWJ（ゼロ幅結合子）シーケンス
**手順:**
1. テキストエリアに「👨‍💻」（男性技術者の絵文字）を入力
2. カウントを確認

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「1」と表示
- ZWJで結合された絵文字が1文字としてカウント

#### 10.5 絵文字修飾シーケンス
**手順:**
1. テキストエリアに「1️⃣2️⃣3️⃣」（キーキャップ絵文字）を入力
2. カウントを確認

**期待される結果:**
- Intl.Segmenter対応ブラウザでは「3」と表示
- 各キーキャップが1文字としてカウント

---

## テスト環境要件

### 必須環境
- **Node.js**: 22.20.0
- **パッケージマネージャー**: pnpm 10.18.0以上
- **ブラウザ**: Playwright対応ブラウザ（Chromium、Firefox、WebKit）
- **開発サーバー**: `http://localhost:3000`で起動

### 推奨環境
- **OS**: macOS、Windows、Linux
- **RAM**: 8GB以上
- **ディスプレイ**: フルHD（1920x1080）以上

## テスト実行前の準備

1. **依存パッケージのインストール**:
   ```bash
   pnpm install
   ```

2. **Playwrightブラウザのインストール**:
   ```bash
   pnpm run install-playwright
   ```

3. **開発サーバーの起動**:
   ```bash
   pnpm run dev
   ```

4. **アプリケーションの確認**:
   - ブラウザで`http://localhost:3000`にアクセスし、正常に表示されることを確認

## テスト成功基準

### 機能的要件
- ✅ すべての文字種（日本語、英語、記号、絵文字）が正確にカウントされる
- ✅ リアルタイムでカウントが更新される
- ✅ 空文字列、長文、特殊文字が適切に処理される
- ✅ ブラウザ互換性が確保されている

### 非機能的要件
- ✅ ページロード時間が3秒以内
- ✅ 1000文字の入力に対してUIが遅延なく応答
- ✅ メモリリークが発生しない
- ✅ WCAG AA基準のアクセシビリティを満たす

### UI/UX要件
- ✅ すべての画面サイズでレイアウトが適切
- ✅ キーボードのみで操作可能
- ✅ 視覚的フィードバックが明確
- ✅ エラー状態が適切に処理される

## 既知の制約事項

1. **Intl.Segmenter API**: 一部の古いブラウザでは未対応。フォールバックとしてコードポイント単位のカウントを使用
2. **ブラウザ依存の動作**: 絵文字の表示や結合文字の処理はブラウザによって異なる場合がある
3. **タブ文字の入力**: ブラウザによってはテキストエリア内でのタブ入力が制限される場合がある

## テスト自動化の推奨アプローチ

### ユニットテスト
- **対象**: `countGraphemeLength`関数（`core/src/app/moji-count/_utils/count-text.ts`）
- **フレームワーク**: Vitest（in-source testing）
- **カバレッジ目標**: 100%

### コンポーネントテスト
- **対象**: `TextField`、`TextLength`コンポーネント
- **フレームワーク**: Storybook + Vitest
- **手法**: インタラクションテスト、スナップショットテスト

### E2Eテスト
- **対象**: 全テストシナリオ
- **フレームワーク**: Playwright
- **優先度**:
  - P0（必須）: 基本的な文字入力とカウント（シナリオ2）
  - P1（高）: エッジケース（シナリオ4）、特殊文字（シナリオ3）
  - P2（中）: アクセシビリティ（シナリオ6）、レスポンシブ（シナリオ7）
  - P3（低）: パフォーマンス（シナリオ8）、ブラウザ互換性（シナリオ9）

## 付録：テストデータ

### 文字列サンプル

**日本語**:
- ひらがな: 「あいうえおかきくけこ」
- カタカナ: 「アイウエオカキクケコ」
- 漢字: 「日本語文字列」
- 混合: 「日本語123ABC」

**英語**:
- 小文字: 「abcdefghijklmnopqrstuvwxyz」
- 大文字: 「ABCDEFGHIJKLMNOPQRSTUVWXYZ」
- 混合: 「Hello World 123」

**記号**:
- 半角: 「!@#$%^&*()_+-={}[]|:;"'<>,.?/」
- 全角: 「！＠＃＄％＾＆＊（）」

**絵文字**:
- 基本: 「😀😃😄😁😆😅🤣😂」
- 結合: 「👨‍👩‍👧‍👦👨‍💻👩‍🎨」
- 修飾: 「👋🏻👋🏼👋🏽👋🏾👋🏿」
- 国旗: 「🇯🇵🇺🇸🇬🇧🇫🇷🇩🇪」

**特殊ユニコード**:
- サロゲートペア: 「𠮷野家𩸽」
- 結合文字: 「が（g + ゛）」
- ゼロ幅文字: 「test​test」（ゼロ幅スペース含む）

---

## 変更履歴

- **2025-10-14**: 初版作成
