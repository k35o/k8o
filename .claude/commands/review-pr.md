---
description: "特化型エージェントを使用した包括的なPRレビュー"
argument-hint: "[レビュー項目]"
allowed-tools: ["Bash", "Glob", "Grep", "Read", "Task"]
---

# 包括的なPRレビュー

複数の特化型エージェントを使用して包括的なプルリクエストレビューを実行します。各エージェントはコード品質の異なる側面に焦点を当てます。

**レビュー項目（オプション）:** "$ARGUMENTS"

## レビューワークフロー:

1. **レビュー範囲の決定**
   - git statusで変更ファイルを特定
   - 引数を解析してユーザーが特定のレビュー項目を要求しているか確認
   - デフォルト: 適用可能なすべてのレビューを実行

2. **利用可能なレビュー項目:**

   - **comments** - コードコメントの正確性と保守性を分析
   - **tests** - テストカバレッジの品質と完全性をレビュー
   - **errors** - サイレント失敗のエラーハンドリングをチェック
   - **types** - 型設計と不変式を分析（新しい型が追加された場合）
   - **code** - プロジェクトガイドラインに対する一般的なコードレビュー
   - **simplify** - 明確性と保守性のためにコードを簡潔化
   - **all** - 適用可能なすべてのレビューを実行（デフォルト）

3. **変更ファイルの特定**
   - `git diff --name-only`で変更ファイルを確認
   - PRが既に存在するか確認: `gh pr view`
   - ファイルタイプとどのレビューが適用されるかを特定

4. **適用可能なレビューの決定**

   変更内容に基づく:
   - **常に適用**: code-reviewer（一般的な品質）
   - **テストファイルが変更された場合**: pr-test-analyzer
   - **コメント/ドキュメントが追加された場合**: comment-analyzer
   - **エラーハンドリングが変更された場合**: silent-failure-hunter
   - **型が追加/変更された場合**: type-design-analyzer
   - **レビュー合格後**: code-simplifier（磨き上げと改善）

5. **レビューエージェントの起動**

   **逐次的アプローチ**（一つずつ）:
   - 理解しやすく、対処しやすい
   - 各レポートが次に進む前に完成
   - 対話的なレビューに適している

   **並列アプローチ**（ユーザーがリクエスト可能）:
   - すべてのエージェントを同時に起動
   - 包括的なレビューで高速
   - 結果がまとめて返される

6. **結果の集約**

   エージェント完了後、要約:
   - **クリティカルな問題**（マージ前に必ず修正）
   - **重要な問題**（修正すべき）
   - **提案**（あると良い）
   - **良好な観察**（良い点）

7. **アクションプランの提供**

   発見事項を整理:
   ```markdown
   # PRレビューサマリー

   ## クリティカルな問題（X件）
   - [エージェント名]: 問題の説明 [ファイル:行]

   ## 重要な問題（X件）
   - [エージェント名]: 問題の説明 [ファイル:行]

   ## 提案（X件）
   - [エージェント名]: 提案 [ファイル:行]

   ## 強み
   - このPRで良くできている点

   ## 推奨アクション
   1. クリティカルな問題を最初に修正
   2. 重要な問題に対処
   3. 提案を検討
   4. 修正後に再度レビューを実行
   ```

## 使用例:

**完全レビュー（デフォルト）:**
```
/review-pr
```

**特定の項目:**
```
/review-pr tests errors
# テストカバレッジとエラーハンドリングのみをレビュー

/review-pr comments
# コードコメントのみをレビュー

/review-pr simplify
# レビュー合格後にコードを簡潔化
```

**並列レビュー:**
```
/review-pr all parallel
# すべてのエージェントを並列で起動
```

## エージェントの説明:

**comment-analyzer**:
- コードに対するコメントの正確性を検証
- コメントの腐敗を特定
- ドキュメントの完全性をチェック

**pr-test-analyzer**:
- 動作ベースのテストカバレッジをレビュー
- クリティカルなギャップを特定
- テストの品質を評価

**silent-failure-hunter**:
- サイレント失敗を発見
- catchブロックをレビュー
- エラーロギングをチェック

**type-design-analyzer**:
- 型のカプセル化を分析
- 不変式の表現をレビュー
- 型設計の品質を評価

**code-reviewer**:
- CLAUDE.mdへの準拠をチェック
- バグと問題を検出
- 一般的なコード品質をレビュー

**code-simplifier**:
- 複雑なコードを簡潔化
- 明確性と可読性を向上
- プロジェクト標準を適用
- 機能を保持

## ヒント:

- **早めに実行**: PR作成後ではなく、作成前に
- **変更に焦点**: エージェントはデフォルトでgit diffを分析
- **クリティカルを優先**: 優先度の低い問題の前に高優先度の問題を修正
- **修正後に再実行**: 問題が解決されたことを確認
- **特定のレビューを使用**: 懸念事項がわかっている場合は特定の項目をターゲットに

## ワークフローへの統合:

**コミット前:**
```
1. コードを書く
2. 実行: /review-pr code errors
3. クリティカルな問題を修正
4. コミット
```

**PR作成前:**
```
1. すべての変更をステージング
2. 実行: /review-pr all
3. すべてのクリティカルと重要な問題に対処
4. 特定のレビューを再実行して確認
5. PRを作成
```

**PRフィードバック後:**
```
1. 要求された変更を実施
2. フィードバックに基づいてターゲットレビューを実行
3. 問題が解決されたことを確認
4. 更新をプッシュ
```

## 注意事項:

- エージェントは自律的に実行し、詳細なレポートを返します
- 各エージェントは深い分析のために専門分野に焦点を当てます
- 結果は具体的なファイル:行参照で実行可能です
- エージェントは複雑さに応じた適切なモデルを使用します
- すべてのエージェントは`/agents`リストで利用可能です
