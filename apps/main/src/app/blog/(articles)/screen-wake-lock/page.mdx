export const metadata = {
  title: '画面のスリープを防ぐScreen Wake Lock API',
  description: 'Baseline 2025にScreen Wake Lock APIが追加されました。Screen Wake Lock APIは、デバイスの画面がスリープ状態に入るのを防ぐためのAPIです。この機能により処理が行われていない状態でも継続的に画面を表示する体験を実現可能になりました。',
  createdAt: '2025-04-04',
  updatedAt: '2025-11-15',
};

import { BaselineStatus } from '@k8o/arte-odyssey/baseline-status';
import { LinkCard } from '@/app/_components/link-card';
import { WakeLockDemo as Example1 } from '@/app/_components/playgrounds/screen-wake-lock';
import { Playground } from '@/app/_components/playgrounds';
import { Image } from '@/app/blog/_components/image';
import monitor from './_images/monitor.png';

# 画面のスリープを防ぐScreen Wake Lock API

<BaselineStatus featureId="screen-wake-lock"></BaselineStatus>

## はじめに

Screen Wake Lock APIが2025年のBaselineに追加されました。
Screen Wake Lock APIは、デバイスの画面がスリープ状態に入るのを防ぐためのAPIです。 料理中もずっとレシピを表示しておけるようにするなど、処理を行わず継続的に画面を表示させたいアプリケーションに役立ちます。

## Screen Wake Lock APIによるスリープを体験する

Screen Wake Lock APIを使用してスリープのロックを要求するボタンを用意しました。

<Playground title="Screen Wake Lock API">
  <Example1 />
</Playground>

「スリープ機能をロックする」ボタンを押して、ロックを獲得すると「スリープ機能のロックを解除する」ボタンに切り替わります。

Macをご使用の場合は、標準のアクティビティモニタを開いて「エネルギー」を確認すると、お使いのブラウザの項目の「非スリープ」が「はい」になっていることでロックされていることを確認できます。

<Image
  src={monitor}
  alt="Macのアクティビティモニタのエネルギーの表でGoogle Chromeの非スリープの項目が「はい」になっている"
/>

ブラウザのタブを切り替えたり、スクリーンを畳んだりすると「非スリープ」が「いいえ」に変わります。

「スリープ機能をロックする」ボタンを押してから別のタブに切り替えて戻ってくると、再び「スリープ機能をロックする」ボタンに戻っていることがわかります。

これは表示中のタブが有効な範囲でのみScreen Wake Lock APIが有効になり、有効範囲からはみ出るとロックが解除されるためです。
この仕様はセキュリティとプライバシーの問題を解決してくれています。

## Screen Wake Lock APIの使い方

Screen Wake Lock APIは、`navigator.wakeLock`から使用します。

`navigator.wakeLock.request()`メソッドを使用すると、画面のスリープを防ぐことを要求し、`WakeLockSentinel`インスタンスを返します。
このインスタンスは、ロックを解除するための`release()`メソッドを持っています。

```js
let wakeLock = null;

// 画面をロックする
wakeLock = await navigator.wakeLock.request('screen');

// 画面のロックを解除する
await wakeLock.release();
```

### navigator.wakeLock.request

`navigator.wakeLock.request`は画面のロックを防ぐことを要求するメソッドです。

`navigator.wakeLock.request`は第1引数にロックする画面についての種類を任意で渡せます。
執筆時点では、何も渡さない時と機能が変わらない`screen`のみがサポートされています。

戻り値は`WakeLockSentinel`インスタンスです。画面をロックする権限がない時には`NotAllowedError`をスローします。

### WakeLockSentinel

`WakeLockSentinel`インスタンスは`released`プロパティと`type`プロパティ、`release()`メソッドを持ちます。

`released`プロパティは`navigator.wakeLock.request`によるロックが解除されているかどうかを示すプロパティで、`type`プロパティはロックの種類を示します。

```js
wakeLock.released; // false
wakeLock.type; // 'screen'
```

`release()`メソッドは`navigator.wakeLock.request`によるロックを解除するためのメソッドです。

```js
// 画面のロックを解除する
await wakeLock.release();
```

`WakeLockSentinel`インスタンスは、`addEventListener`で`release`を指定して、`navigator.wakeLock.request`によるロックが解除されたときに発火するイベントを登録できます。

```js
const wakeLock = await navigator.wakeLock.request('screen');
// タブを切り替えるなど、何かしらの操作によるロックの解除を検知する
wakeLock.addEventListener('release', () => {
  console.log('Wake Lock was released');
});
```

`navigator.wakeLock.request`によるロックが解除された時に発火するだけで、実際のロック状況には依存しないことに注意してください。

## おわりに

Baseline 2025に追加された、Screen Wake Lock APIの紹介を行いました。
ページを開いたままデバイスの外側で作業を行うときに悩まされるスリープの問題を解決してくれるAPIです。

ぜひ、Screen Wake Lock APIを使用して、より良い体験を提供できるようにしましょう。
